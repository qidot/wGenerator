$(document).ready(function(){Popper.Defaults.modifiers.computeStyle.gpuAcceleration=false;if($(window).width()<769){$("body").addClass("body-small")}else{$("body").removeClass("body-small")}var a=$("#side-menu").metisMenu();a.on("shown.metisMenu",function(b){fix_height()});$(".collapse-link").on("click",function(d){d.preventDefault();var f=$(this).closest("div.ibox");var b=$(this).find("i");var c=f.children(".ibox-content");c.slideToggle(200);b.toggleClass("fa-chevron-up").toggleClass("fa-chevron-down");f.toggleClass("").toggleClass("border-bottom");setTimeout(function(){f.resize();f.find("[id^=map-]").resize()},50)});$(".close-link").on("click",function(c){c.preventDefault();var b=$(this).closest("div.ibox");b.remove()});$(".fullscreen-link").on("click",function(c){c.preventDefault();var d=$(this).closest("div.ibox");var b=$(this).find("i");$("body").toggleClass("fullscreen-ibox-mode");b.toggleClass("fa-expand").toggleClass("fa-compress");d.toggleClass("fullscreen");setTimeout(function(){$(window).trigger("resize")},100)});$(".close-canvas-menu").on("click",function(b){b.preventDefault();$("body").toggleClass("mini-navbar");SmoothlyMenu()});$("body.canvas-menu .sidebar-collapse").slimScroll({height:"100%",railOpacity:0.9});$(".right-sidebar-toggle").on("click",function(b){b.preventDefault();$("#right-sidebar").toggleClass("sidebar-open")});$(".sidebar-container").slimScroll({height:"100%",railOpacity:0.4,wheelStep:10});$(".open-small-chat").on("click",function(b){b.preventDefault();$(this).children().toggleClass("fa-comments").toggleClass("fa-times");$(".small-chat-box").toggleClass("active")});$(".small-chat-box .content").slimScroll({height:"234px",railOpacity:0.4});$(".check-link").on("click",function(){var c=$(this).find("i");var b=$(this).next("span");c.toggleClass("fa-check-square").toggleClass("fa-square-o");b.toggleClass("todo-completed");return false});$(".navbar-minimalize").on("click",function(b){b.preventDefault();$("body").toggleClass("mini-navbar");SmoothlyMenu()});$(".tooltip-demo").tooltip({selector:"[data-toggle=tooltip]",container:"body"});$(window).scroll(function(){if($(window).scrollTop()>0&&!$("body").hasClass("fixed-nav")){$("#right-sidebar").addClass("sidebar-top")}else{$("#right-sidebar").removeClass("sidebar-top")}});$("[data-toggle=popover]").popover();$(".full-height-scroll").slimscroll({height:"100%"});$("#myModal5").on("hidden.bs.modal",function(b){$("#myModal5 .modal-content").html("")})});$(window).bind("load",function(){if($("body").hasClass("fixed-sidebar")){$(".sidebar-collapse").slimScroll({height:"100%",railOpacity:0.9})}});function fix_height(){var c=$("body > #wrapper").height()-62;$(".sidebar-panel").css("min-height",c+"px");var a=$("nav.navbar-default").height();var b=$("#page-wrapper").height();if(a>b){$("#page-wrapper").css("min-height",a+"px")}if(a<b){$("#page-wrapper").css("min-height",$(window).height()+"px")}if($("body").hasClass("fixed-nav")){if(a>b){$("#page-wrapper").css("min-height",a+"px")}else{$("#page-wrapper").css("min-height",$(window).height()-60+"px")}}$("#main-content").css("min-height",$(window).height()-140+"px")}$(window).bind("load resize scroll",function(){setTimeout(function(){if(!$("body").hasClass("body-small")){fix_height()}})});$(window).bind("resize",function(){if($(this).width()<769){$("body").addClass("body-small")}else{$("body").removeClass("body-small")}setTimeout(refreshTabContent,400)});$(document).ready(function(){if(localStorageSupport()){var e=localStorage.getItem("collapse_menu");var f=localStorage.getItem("fixedsidebar");var d=localStorage.getItem("fixednavbar");var b=localStorage.getItem("boxedlayout");var c=localStorage.getItem("fixedfooter");var a=$("body");if(f=="on"){a.addClass("fixed-sidebar");$(".sidebar-collapse").slimScroll({height:"100%",railOpacity:0.9})}if(e=="on"){if(a.hasClass("fixed-sidebar")){if(!a.hasClass("body-small")){a.addClass("mini-navbar")}}else{if(!a.hasClass("body-small")){a.addClass("mini-navbar")}}}if(d=="on"){$(".navbar-static-top").removeClass("navbar-static-top").addClass("navbar-fixed-top");a.addClass("fixed-nav")}if(b=="on"){a.addClass("boxed-layout")}if(c=="on"){$(".footer").addClass("fixed")}}});function localStorageSupport(){return(("localStorage" in window)&&window.localStorage!==null)}function animationHover(a,b){a=$(a);a.hover(function(){a.addClass("animated "+b)},function(){window.setTimeout(function(){a.removeClass("animated "+b)},2000)})}function SmoothlyMenu(){if(!$("body").hasClass("mini-navbar")||$("body").hasClass("body-small")){$("#side-menu").hide();console.log("收缩工具栏按钮","1");setTimeout(function(){$("#side-menu").fadeIn(400,refreshTabContent)},200)}else{if($("body").hasClass("fixed-sidebar")){console.log("收缩工具栏按钮","2");$("#side-menu").hide();setTimeout(function(){$("#side-menu").fadeIn(400,refreshTabContent)},100)}else{console.log("收缩工具栏按钮","3");$("#side-menu").removeAttr("style");setTimeout(refreshTabContent,400)}}}function refreshTabContent(){var g=$(".J_iframe:visible");if(g.length>0){var a=$(window).height()-235;if($(".ibox-title",g).length>0){a-=$(".ibox-title",g).outerHeight()}var e=$("#main-content").width();g.css("width",e);var d=g.find(".ui-jqgrid").attr("id");if(d!=null&&d!=""){d=d.replace("gbox_","");var c=$("#"+d,g);var f=d.replace("_table","_col");var b=$("#"+f,g);if(b.length>0){e=e*parseFloat(b.data("percent"))}c.setGridWidth(e-30,true).setGridHeight(a)}}}function WinMove(){var b="[class*=col]";var c=".ibox-title";var a="[class*=col]";$(b).sortable({handle:c,connectWith:a,tolerance:"pointer",forcePlaceholderSize:true,opacity:0.8}).disableSelection()}function tip(b,d,a){var e=a||"info";var c=b||"请输入消息内容";var d=d||"提示";toastr.options={closeButton:true,debug:false,progressBar:false,preventDuplicates:false,positionClass:"toast-top-right",onclick:null,showDuration:400,hideDuration:2000,timeOut:2000,showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"};if("success"==a){toastr.success(c,d)}else{if("info"==a){toastr.info(c,d)}else{if("warning"==a){toastr.warning(c,d)}else{toastr.error(c,d)}}}}function openWindow(b,a,c){if(typeof c=="undefined"){c="modal-lg"}$("#myModal5 .modal-dialog").attr("class","modal-dialog "+c);reloadWindow(b,a);$("#myModal5").modal("show")}function reloadWindow(b,a){var c={};if(typeof(b)=="undefined"){c=$("#myModal5 .modal-content").data("info");if(typeof c!="object"){c=JSON.parse(c)}b=c.url;a=c.options}else{c.url=b;c.options=a}console.log(c);$("#myModal5 .modal-content").data("info",c);$("#myModal5 .modal-content").load(b,a,function(g,d,h){if(d=="success"){$("#myModal5 .modal-title").on("dblclick",function(){reloadWindow()});if(typeof ModalLoadReady=="function"){ModalLoadReady()}}else{var e="Error: "+h.status+": "+h.statusText;if(h.status==401){e="登录已过期或权限被去除!"}else{if(h.status==404){e="请求的URL不存在,"+b}}var f='<div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>\n    <h4 class="modal-title zdy">错误</h4>\n    </div>\n    <div class="modal-body">\n'+e+"    </div>";$("#myModal5 .modal-content").html(f)}})}function closeWindow(){$("#myModal5").modal("hide")}function formAjaxSubmit(e){if(e==null){tip("需要先指定表单基本信息","错误","error");return false}if(e.baseValidate!=null){var d=$(e.id).validate(e.baseValidate);if(!d.form()){return false}}var b=$(e.id).serializeJSON();if(e.advanceValidate!=null&&typeof(e.advanceValidate)=="function"){var f=e.advanceValidate(b);if(!f){return false}}var c=$(e.id).attr("action");var g=$(e.id).attr("method");var a=$(e.button).attr("onclick");$(e.button).removeAttr("onclick");if(e.loading){$(e.button).ladda();$(e.button).ladda("start")}$.ajax({url:c,type:g||"GET",dataType:"json",data:JSON.stringify(b),contentType:"application/json",success:function(h){$(e.button).attr("onclick",a);if(e.loading){$(e.button).ladda("stop")}if(h.success){tip(h.message,"提示","success");if(typeof(e.callback)=="function"){e.callback(h)}if(e.closeModal){closeWindow()}}else{tip(h.message,"提示","error")}},error:function(k,h,j){$(e.button).attr("onclick",a);if(e.loading){setTimeout(function(){$(e.button).ladda("stop")},1000)}var i="Error: "+k.status+": "+k.statusText;if(k.status==401){i="登录已过期或权限被去除!"}else{if(k.status==404){i="请求的URL不存在,"+c}}tip(i,"提示","error")}});return false}function mountGrid(b){var a=$(window).height()-235-$(".ibox-title",$(b.container)).outerHeight();if(a<100){a=300}$(b.id).jqGrid({url:b.url,datatype:"json",ajaxGridOptions:{contentType:"application/json; charset=utf-8"},mtype:"POST",postData:typeof(b.queryData)!="undefined"?b.queryData:{},serializeGridData:function(c){return JSON.stringify(c)},height:a,scrollOffset:18,emptyrecords:"暂无数据",autowidth:typeof(b.autoWidth)!="undefined"?b.autoWidth:true,shrinkToFit:true,rowNum:typeof(b.rowNum)!="undefined"?b.rowNum:20,rowList:[10,20,50,100],colNames:b.header,colModel:b.columns,pager:b.pager,viewrecords:true,hidegrid:false,jsonReader:{root:"data.list",page:"data.pagination.current",total:"data.pagination.pages",records:"data.pagination.total",cell:"",id:"0"},multiselect:typeof(b.multiSelect)!="undefined"?b.multiSelect:true,loadError:function(e,c,d){if(e.status==401){tip("登录已过期,或无权访问","错误","error")}else{if(e.status==404){tip("请求Url["+b.url+"]不存在","错误","error")}else{tip("错误:"+d,"错误","error")}}},loadComplete:function(c){if(!c.success){tip(c.message,"加载列表错误","error")}}})}function initFormRemoteData(formId){$(".chosen-select",$(formId)).chosen({width:"100%",disable_search:true});$(formId).find("[data-url]").each(function(){var me=$(this);var url=$(this).data("url");var control=$(this).data("control");var cname=$(this).data("cname");var append=$(this).data("append");var callback=$.trim($(this).data("callback"));var query={};if($(this).data("query")!=null){query=JSON.parse($(this).data("query"))}var defaultValue=$(this).data("val");if(defaultValue==null){defaultValue=""}else{defaultValue=defaultValue+""}$.ajax({url:url,type:"POST",dataType:"json",data:JSON.stringify(query),contentType:"application/json",success:function(res){if(res.success){var html="";if(me[0].tagName=="SELECT"){if(append!=null&&append!=""){var appendArr=append.split("|");html+="<option value='"+appendArr[0]+"'>"+appendArr[1]+"</option>"}$.each(res.data,function(i,v){if(typeof(v.id)!="undefined"){html+="<option value='"+v.id+"'>"+v.name+"</option>"}else{if(typeof(v.key)!="undefined"){html+="<option value='"+v.key+"'>"+v.value+"</option>"}}});me.empty().html(html);if(defaultValue!=""){console.log("设置默认值");$(me).val(defaultValue+"")}if($(me).attr("class").indexOf("chosen-select")>=0){$(me).trigger("chosen:updated")}}else{if(control.toUpperCase()=="CHECKBOX"){$.each(res.data,function(i,v){var vv=typeof(v.id)!="undefined"?v.key:v.id;var checked=defaultValue.indexOf(vv)>=0?"checked":"";if(typeof(v.id)!="undefined"){html+="<label><input type='checkbox' name='"+cname+"[]' "+checked+" value='"+v.id+"'> "+v.name+"</label>"}else{if(typeof(v.key)!="undefined"){html+="<label><input type='checkbox' name='"+cname+"[]' "+checked+" value='"+v.key+"'> "+v.value+"</label>"}}});me.empty().html(html)}else{if(control.toUpperCase()=="RADIO"){$.each(res.data,function(i,v){var vv=typeof(v.id)!="undefined"?v.key:v.id;var checked=defaultValue.indexOf(vv)>=0?"checked":"";if(typeof(v.id)!="undefined"){html+="<label><input type='radio' name='"+cname+"' "+checked+" value='"+v.id+"'> "+v.name+"</label>"}else{if(typeof(v.key)!="undefined"){html+="<label><input type='radio' name='"+cname+"' "+checked+" value='"+v.key+"'> "+v.value+"</label>"}}});me.empty().html(html)}}}if(callback!=""){eval(callback)}}else{tip(res.message,"初始化失败","error")}},error:function(xhr,status,err){var loadError="Error: "+xhr.status+": "+xhr.statusText;if(xhr.status==401){loadError="登录已过期或权限被去除!"}else{if(xhr.status==404){loadError="请求的URL不存在!"+url}}tip(loadError,"提示","error")}})})}function getGridSelectIds(a){return $(a).jqGrid("getGridParam","selarrrow")}function myAjax(c,d,a,b){$.ajax({url:c,type:"POST",dataType:"json",data:JSON.stringify(d),contentType:"application/json",success:function(e){a(e)},error:function(i,e,h){var f="Error: "+i.status+": "+i.statusText;var g=i.status;if(i.status==401){f="登录已过期或权限被去除!";if(c=="/logout1"){document.location.href="/login";return}}else{if(i.status==404){f="请求的URL不存在!"+c}}if(typeof b=="function"){b(g,f)}}})}function myConfirm(a,b,c){swal({title:"提示",text:typeof(a)=="undefined"?"行为有风险,是否继续?":a,type:"warning",showCancelButton:true,confirmButtonColor:"#DD6B55",confirmButtonText:b||"是的,继续",closeOnConfirm:true,icon:""},function(d){c(d)})}function myAlert(c,d,b){var a={title:typeof(d)=="undefined"?"提示":d,text:typeof(c)=="undefined"?"你什么也没有说!":c,type:typeof(b)=="undefined"?"success":b};swal(a)}function formatEnable(a,b,c){if(a==1){return'<span class="label label-primary"><i class="fa fa-check"></i></span>'}return'<span class="label label-danger"><i class="fa fa-lock"></i></span>'}function formatYesNo(a,b,c){if(a==1){return'<span class="label label-primary">Yes</span>'}return'<span class="label label-warning">No</span>'}function formatAvator(a,b,c){if(a==null||a==""){return""}return'<img src="'+a+'" style="width:50px;max-height:50px;"/>'}jQuery.extend($.fn.fmatter,{formatEnable:function(a,b,c){return formatEnable(a,b,c)},formatYesNo:function(a,b,c){return formatYesNo(a,b,c)},formatAvator:function(a,b,c){return formatAvator(a,b,c)}});function getGridSelect(d,e,c){var a=getGridSelectIds(d);if(a==null||a.length<=0){tip((e||"请先选中要编辑的行!"),"","error");return null}var b=[];var f=c||false;$.each(a,function(h,g){b.push($(d).jqGrid("getRowData",g));if(!f){return false}});return f?b:b[0]}function refreshGrid(b,c){var a=$(c).serializeJSON();$(b).jqGrid("setGridParam",{datatype:"json",postData:a,page:1}).trigger("reloadGrid")}function refreshTab(){$(".J_tabRefresh").click()}function advanceReset(a){$(".chosen-select",$(a)).trigger("change");setTimeout(function(){$(".chosen-select",$(a)).trigger("chosen:updated")},500)}function initTabSorter(){$(".page-tabs-content").sortable({stop:function(a,b){var c=$(b.item[0]).data("code");setTimeout(function(){if($.trim(c)==""){$("#handler_tab_a").click()}else{$(".J_menuItem[data-code='"+c+"']").click()}},300)}}).disableSelection()}function initPageFields(c,b,a){$("ul.list-menu",$(c)).sortable({stop:function(d,e){setTimeout(function(){var f=[];var g=[];$("div.dropdown-menu a",$(c)).each(function(j,h){var k=$(this).data("code");f.push(a.indexOf(k));g.push(k)});a=g;$(b).remapColumns(f,true,false)},500)}}).disableSelection()}function savePageFields(e){var c=$(e).parent().parent();var d=c.data("mc");var b=[];$("a",c).each(function(g,f){var h=$(this).data("code");if(h!=""){b.push(h)}});var a=b.join(",");myAjax("/api/sm/saveUserCol",{menuCode:d,content:a},function(f){if(f.success){tip("页面自定义成功","提示","success")}else{tip(f.message)}},function(f,g){tip(g)})}function resetPageFields(c){var a=$(c).parent().parent();var b=a.data("mc");myConfirm("确定要继续重置页面信息吗?","继续",function(d){if(!d){return}myAjax("/api/sm/resetUserCol",{menuCode:b,},function(e){if(e.success){tip("页面重置成功","提示","success")}else{tip(e.message)}},function(e,f){tip(f)})})};